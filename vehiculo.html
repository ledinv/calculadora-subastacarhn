<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle del Vehículo | SubastaCarHN</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #002f6c;
      --accent: #ffc20e;
      --text: #333;
      --bg: #f9f9f9;
      --card-bg: #fff;
      --shadow: rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--text); }
    header, footer { background: var(--card-bg); padding: 1rem; }
    .container { max-width: 900px; margin: 0 auto; padding: 1rem; }
    #detalleVehiculo img { width: 100%; max-width: 600px; border-radius: 8px; display:block; margin: 0 auto; }
    #detalleVehiculo h1 { margin-top:1rem; color: var(--primary); text-align:center; }
    #detalleVehiculo .info { margin: 1rem 0; line-height: 1.5; }
    #detalleVehiculo .info p { margin: .5rem 0; }
    #detalleVehiculo .price { font-size: 1.5rem; color: var(--accent); font-weight:700; margin: .5rem 0; }
    #detalleVehiculo .gallery { display: flex; gap: .5rem; overflow-x: auto; margin-top: 1rem; }
    #detalleVehiculo .gallery img { width: 120px; height: 80px; object-fit:cover; border-radius: 4px; cursor:pointer; }
    #sugerencias h2 { text-align: center; color: var(--primary); margin-bottom: 1rem; }
    #autosSugeridos { display: grid; gap:1rem; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); }
    .card { background: var(--card-bg); border-radius: 8px; overflow:hidden; box-shadow:0 4px 10px var(--shadow); cursor:pointer; transition: transform .2s; }
    .card:hover { transform: translateY(-4px); }
    .card img { width:100%; height:120px; object-fit:cover; }
    .card .content { padding:.5rem; }
    .card .content h3 { font-size:1rem; margin-bottom:.5rem; text-transform:capitalize; }
    .card .content .price { color: var(--accent); font-weight:700; }
  </style>
</head>
<body>

  <header>
    <div class="container">
      <a href="index.html">SubastaCarHN</a> |
      <a href="calculadora.html">Calculadora</a> |
      <a href="inventario.html">Automóviles</a>
    </div>
  </header>

  <main class="container">
    <!-- Detalle del vehículo -->
    <section id="detalleVehiculo"></section>

    <!-- Sugerencias -->
    <section id="sugerencias">
      <h2>También te puede interesar</h2>
      <div id="autosSugeridos"></div>
    </section>
  </main>

  <footer>
    <div class="container" style="text-align:center;">
      SubastaCarHN — Importaciones claras, seguras y al mejor precio
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Inicializa Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA5BuOwgEUYK1JMwJD0PL0k0rcAST_Koms",
      authDomain: "subastacarhn-40554.firebaseapp.com",
      projectId: "subastacarhn-40554",
      storageBucket: "subastacarhn-40554.appspot.com",
      messagingSenderId: "536785797974",
      appId: "1:536785797974:web:e3eabb4dcd898c2ffe8cf7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Obtiene el parámetro id de la URL
    const params = new URLSearchParams(window.location.search);
    const vehiculoId = params.get('id');

    const detalleEl = document.getElementById('detalleVehiculo');
    const sugeridosEl = document.getElementById('autosSugeridos');

    // Carga y renderiza el vehículo
    async function cargarVehiculo() {
      if (!vehiculoId) {
        detalleEl.innerHTML = '<p>Vehículo no encontrado.</p>';
        return;
      }

      try {
        const doc = await db.collection('inventario').doc(vehiculoId).get();
        if (!doc.exists) {
          detalleEl.innerHTML = '<p>Vehículo no disponible.</p>';
          return;
        }

        const auto = { id: doc.id, ...doc.data() };

        // Galería de imágenes
        const galleryHtml = (Array.isArray(auto.imagenes) ? auto.imagenes : [])
          .map(url =>
            `<img src="${url}" alt="${auto.modelo}" onclick="cambiarImagen('${url}')">`
          ).join('');

        // Detalle principal
        detalleEl.innerHTML = `
          <img id="mainImage" src="${auto.imagenes?.[0]||''}" alt="${auto.modelo}">
          <div class="info">
            <h1>${auto.marca} ${auto.modelo} (${auto.anio})</h1>
            <div class="price">L ${ (typeof auto.precio==='number') ? auto.precio.toLocaleString() : 'N/A' }</div>
            <p><strong>Motor:</strong> ${auto.motor||'–'}</p>
            <p><strong>Color:</strong> ${auto.color||'–'}</p>
            <p><strong>Tipo:</strong> ${auto.tipo||'–'}</p>
            <p><strong>Kilometraje:</strong> ${(typeof auto.kilometraje==='number')?auto.kilometraje.toLocaleString()+' km':'–'}</p>
            <p style="margin-top:1rem;">${auto.descripcion||''}</p>
          </div>
          ${ galleryHtml ? `<div class="gallery">${galleryHtml}</div>` : '' }
        `;

        cargarSugerencias(auto);
      } catch (e) {
        console.error('Error cargando vehículo:', e);
        detalleEl.innerHTML = '<p>Error al cargar vehículo.</p>';
      }
    }

    // Cambia imagen principal al clicar miniatura
    function cambiarImagen(url) {
      document.getElementById('mainImage').src = url;
    }

    // Carga sugerencias de la misma marca
    async function cargarSugerencias(actual) {
      try {
        sugeridosEl.innerHTML = '';
        const snapshot = await db.collection('inventario')
          .where('marca', '==', actual.marca)
          .get();

        snapshot.docs.forEach(doc => {
          const auto = { id: doc.id, ...doc.data() };
          if (auto.id === actual.id) return;

          const urlImg = auto.imagenes?.[0] || '';
          const precio = (typeof auto.precio==='number') ? auto.precio.toLocaleString() : 'N/A';

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${urlImg}" alt="${auto.modelo}">
            <div class="content">
              <h3>${auto.marca} ${auto.modelo} (${auto.anio})</h3>
              <div class="price">L ${precio}</div>
            </div>
          `;
          card.addEventListener('click', () => {
            window.location.href = `vehiculo.html?id=${auto.id}`;
          });
          sugeridosEl.appendChild(card);
        });
      } catch (e) {
        console.error('Error cargando sugerencias:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', cargarVehiculo);
  </script>
</body>
</html>
