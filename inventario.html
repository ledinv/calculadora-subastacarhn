<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Automóviles en Venta | SubastaCarHN</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  
  <style>
    /* Estilos mínimos para ver el grid */
    body { font-family: sans-serif; margin: 2rem; }
    #autosGrid { 
      display: grid; 
      gap: 1rem; 
      grid-template-columns: repeat(auto-fill,minmax(200px,1fr));
    }
    .card { border:1px solid #ccc; border-radius:6px; overflow:hidden; cursor:pointer; }
    .card img { width:100%; height:150px; object-fit:cover; }
    .card h3, .card p { margin:0.5rem; }
  </style>

  <script>
    // 1) Inicializa Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA5BuOwgEUYK1JMwJD0PL0k0rcAST_Koms",
      authDomain: "subastacarhn-40554.firebaseapp.com",
      projectId: "subastacarhn-40554",
      storageBucket: "subastacarhn-40554.appspot.com",
      messagingSenderId: "536785797974",
      appId: "1:536785797974:web:e3eabb4dcd898c2ffe8cf7"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>

<body>
  <h1>Automóviles en Venta</h1>
  <div id="autosGrid"></div>

  <script>
    const autosGrid = document.getElementById('autosGrid');

    // 2) Carga inventario desde Firestore
    async function cargarInventario() {
      try {
        const snapshot = await db.collection('inventario').get();
        const inventario = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        mostrarAutos(inventario);
      } catch (e) {
        console.error("Error leyendo Firestore:", e);
        autosGrid.innerHTML = "<p>Error al cargar inventario.</p>";
      }
    }

    // 3) Renderiza cada auto en un card
    function mostrarAutos(autos) {
      autosGrid.innerHTML = "";
      if (autos.length === 0) {
        autosGrid.innerHTML = "<p>No hay vehículos para mostrar.</p>";
        return;
      }
      autos.forEach(auto => {
        // toma la primera imagen si existe
        const imgUrl = Array.isArray(auto.imagenes) && auto.imagenes.length
          ? auto.imagenes[0]
          : "";

        const card = document.createElement('div');
        card.className = "card";
        card.innerHTML = `
          <img src="${imgUrl}" alt="${auto.marca} ${auto.modelo}" />
          <h3>${auto.marca} ${auto.modelo} (${auto.anio})</h3>
          <p>L ${auto.precio.toLocaleString()}</p>
        `;
        card.addEventListener('click', () => {
          // redirige con id al detalle
          window.location.href = `vehiculo.html?id=${auto.id}`;
        });
        autosGrid.appendChild(card);
      });
    }

    // 4) Arranca todo al cargar la página
    document.addEventListener('DOMContentLoaded', cargarInventario);
  </script>
</body>
</html>
