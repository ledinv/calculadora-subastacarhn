<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora SubastaCarHN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f4f6f9;
      font-family: 'Segoe UI', sans-serif;
      font-size: 0.9rem;
      margin: 0;
    }
    header {
      background: linear-gradient(to right, #72b5ff, #004ba0);
      height: 80px;
      display: flex;
      align-items: center;
      padding-left: 30px;
    }
    header h1 {
      color: white;
      font-size: 24px;
      margin: 0;
    }
    .container-box {
      max-width: 880px;
      margin: 30px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    label {
      font-weight: 500;
      font-size: 0.85rem;
    }
    input, select {
      height: 34px !important;
      font-size: 0.85rem !important;
    }
    table {
      font-size: 0.85rem;
    }
    table td {
      padding: 4px 8px;
    }
  </style>
</head>
<body>
  <header>
    <h1>SUBASTACARHN</h1>
  </header>

  <div class="container-box">
    <h4 class="text-center mb-4">Calculadora de Importación de Vehículos</h4>

    <div class="form-row">
      <div class="form-group col-md-4">
        <label for="c1">Monto de Oferta (C1):</label>
        <input type="number" id="c1" class="form-control" value="3000">
      </div>
      <div class="form-group col-md-4">
        <label for="c7">Precio de Barco (C7):</label>
        <input type="number" id="c7" class="form-control" value="950">
      </div>
      <div class="form-group col-md-4">
        <label for="c8">Precio de Grua (C8):</label>
        <input type="number" id="c8" class="form-control" value="375">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-4">
        <label for="e2">Tipo de Cambio (E2):</label>
        <input type="number" id="e2" class="form-control" value="25.78" readonly>
      </div>
      <div class="form-group col-md-4">
        <label for="c13">VIN (C13):</label>
        <select id="c13" class="form-control">
          <option value="1,4,5">1,4,5</option>
          <option value="OTROS">OTROS</option>
        </select>
      </div>
      <div class="form-group col-md-4">
        <label for="c14">Tipo de Vehículo (C14):</label>
        <select id="c14" class="form-control">
          <option value="PICK UP">PICK UP</option>
          <option value="OTROS">OTROS</option>
        </select>
      </div>
    </div>

    <button class="btn btn-primary btn-block mb-4" id="calculateBtn">Calcular</button>

    <div id="results"></div>
  </div>

  <script>
    const formatear = valor => new Intl.NumberFormat("es-HN", {
      style: "currency", currency: "HNL"
    }).format(valor);

    const buyerFees = [
      [50.00, 1.00], [100.00, 25.00], [200.00, 60.00], [350.00, 90.00], [400.00, 125.00],
      [450.00, 135.00], [500.00, 145.00], [550.00, 155.00], [600.00, 170.00], [700.00, 195.00],
      [800.00, 215.00], [900.00, 215.00], [1000.00, 250.00], [1200.00, 270.00], [1300.00, 285.00],
      [1400.00, 300.00], [1500.00, 315.00], [1600.00, 330.00], [1700.00, 350.00], [1800.00, 370.00],
      [2000.00, 390.00], [2400.00, 425.00], [2500.00, 460.00], [3000.00, 505.00], [3500.00, 555.00],
      [4000.00, 600.00], [4500.00, 625.00], [5000.00, 650.00], [6000.00, 700.00], [7000.00, 755.00],
      [8000.00, 800.00], [9000.00, 820.00], [10000.00, 850.00], [11000.00, 850.00],
      [12000.00, 875.00], [13000.00, 890.00], [14000.00, 900.00], [15000.00, 900.00]
    ];

    const virtualBidFees = [
      [100, 49], [500, 65], [1000, 85], [2000, 95], [4000, 125], [6000, 145], [8000, 145],
      [9000, 160], [10000, 160], [200000, 160]
    ];

    function buscarValor(tabla, valor) {
      let resultado = 0;
      for (let i = tabla.length - 1; i >= 0; i--) {
        if (valor >= tabla[i][0]) {
          resultado = tabla[i][1];
          break;
        }
      }
      return resultado;
    }

    function buscarBuyerFee(c1) {
      return c1 > 15000 ? +(c1 * 0.06).toFixed(2) : buscarValor(buyerFees, c1);
    }

    function buscarVirtualBidFee(c1) {
      return c1 > 8000 ? 160 : buscarValor(virtualBidFees, c1);
    }

    function calcular() {
      const c1 = parseFloat(document.getElementById('c1').value);
      const c7 = parseFloat(document.getElementById('c7').value);
      const c8 = parseFloat(document.getElementById('c8').value);
      const e2 = parseFloat(document.getElementById('e2').value);
      const c13 = document.getElementById('c13').value;
      const c14 = document.getElementById('c14').value;

      const c2 = 15;
      const c3 = buscarVirtualBidFee(c1);
      const c4 = buscarBuyerFee(c1);
      const c5 = 115;
      const c6 = c1 + c2 + c3 + c4 + c5;
      const c9 = c7 + c8;
      const c10 = c6 + c9;
      const c11 = c10 * e2;

      const n3 = 50;
      const n4 = c6 * 0.015;
      const o3 = n3 * e2;
      const o4 = n4 * e2;

      const c15 = (c13 === "OTROS") ? (c11 + o3 + o4) * 0.15 : 0;

      let isc = 0;
      if (c10 <= 7000) isc = 0.10;
      else if (c10 <= 10000) isc = 0.15;
      else if (c10 <= 20000) isc = 0.20;
      else if (c10 <= 30000) isc = 0.30;
      else isc = 0.45;

      const c16 = (c14 === "OTROS") ? (c11 + o3 + o4 + c15) * isc : 0;
      const c17 = (c11 + c15 + c16 + o3 + o4) * 0.15;
      const c18 = c15 + c16 + c17;

      const c25 = 5000 + 4000 + 7500 + 4000 + 1417.81;
      const c26 = c11 + c18 + c25 + o3 + o4;

      document.getElementById('results').innerHTML = `
        <table class="table table-sm table-bordered">
          <tbody>
            <tr><td><strong>Total Lempiras</strong></td><td><strong>${formatear(c26)}</strong></td></tr>
            <tr><td>FOB (L)</td><td>${formatear(c11)}</td></tr>
            <tr><td>Impuestos</td><td>${formatear(c18)}</td></tr>
            <tr><td>Gastos Fijos</td><td>${formatear(c25)}</td></tr>
          </tbody>
        </table>
      `;
    }

    document.getElementById('calculateBtn').addEventListener('click', calcular);

    window.addEventListener('load', () => {
      fetch("https://dolar-ficohsa-api.onrender.com/api/tipo-cambio")
      .then(res => res.json())
      .then(data => { document.getElementById('e2').value = data.tipoCambio; })
      .catch(() => { document.getElementById('e2').value = 25.7784; });
    });
  </script>
</body>
</html>
