<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar Sesión – SubastaCarHN</title>
  <link rel="manifest" href="Img/site.webmanifest">
  <link rel="apple-touch-icon" sizes="180x180" href="Img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="Img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="Img/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="192x192" href="Img/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="Img/android-chrome-512x512.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="Img/favicon-32x32.png">
  <meta name="theme-color" content="#002f6c">
  <style>
    /* Aquí van tus estilos tal como estaban */
    body { font-family: Helvetica, sans-serif; margin:0; padding:0; background:#f9f9f9; }
    /* …el resto de tu CSS… */
  </style>
</head>
<body>
  <header>
    <div class="menu-icon" onclick="toggleMenu()">☰</div>
    <a href="index.html" class="brand">SUBASTACARHN</a>
  </header>
  <ul id="menu-links">
    <!-- tus enlaces sociales -->
  </ul>

  <div class="layout">
    <div class="contenido-central">
      <h1>Iniciar Sesión</h1>
      <form id="loginForm">
        <label for="emailL">Correo electrónico</label>
        <input type="email" id="emailL" required />

        <label for="passwordL">Contraseña</label>
        <input type="password" id="passwordL" minlength="8" required />

        <button type="submit" class="styled-btn">Entrar</button>

        <p class="forgot">
          <a href="#" id="forgot-link">¿Olvidaste tu contraseña?</a>
        </p>
      </form>
      <p style="text-align:center; margin-top:15px;">
        ¿No tienes cuenta? <a href="register.html">Registrarse</a>
      </p>
    </div>
  </div>

  <!-- Modal de recuperación -->
  <div id="resetModal" class="modal">
    <!-- …contenido del modal… -->
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script>
    // 1) Tu configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA5BuOwgEUYK1JMwJD0PL0k0rcAST_Koms",
      authDomain: "subastacarhn-40554.firebaseapp.com",
      projectId: "subastacarhn-40554",
      storageBucket: "subastacarhn-40554.firebasestorage.app",
      messagingSenderId: "536785797974",
      appId: "1:536785797974:web:e3eabb4dcd898c2ffe8cf7",
      measurementId: "G-QM5N60K8C0"
    };
    firebase.initializeApp(firebaseConfig);

    // 2) Función para abrir/cerrar menú
    function toggleMenu() {
      const m = document.getElementById('menu-links');
      m.style.display = m.style.display === 'block' ? 'none' : 'block';
    }

    // 3) Lógica de login y recuperación
    window.addEventListener('DOMContentLoaded', () => {
      // — LOGIN —
      document.getElementById('loginForm').addEventListener('submit', async e => {
        e.preventDefault();
        const email = document.getElementById('emailL').value.trim();
        const pass  = document.getElementById('passwordL').value;
        try {
          // Inicia sesión con correo y contraseña
          await firebase.auth().signInWithEmailAndPassword(email, pass);

          // Forzamos recarga del estado de emailVerified
          await firebase.auth().currentUser.reload();
          const user = firebase.auth().currentUser;

          if (!user.emailVerified) {
            alert('⚠️ Verifica tu correo antes de continuar.');
            return;
          }
          // Si todo está OK, redirigimos
          window.location.href = 'index.html';

        } catch(err) {
          const msg = (err.code==='auth/user-not-found' || err.code==='auth/wrong-password')
            ? '⚠️ Email o contraseña incorrectos.'
            : err.message;
          alert(msg);
        }
      });

      // — RECUPERAR CONTRASEÑA —
      const forgotLink = document.getElementById('forgot-link');
      const modal      = document.getElementById('resetModal');
      const closeBtn   = modal.querySelector('.close');
      const resetForm  = document.getElementById('reset-form');
      const resetMsg   = document.getElementById('reset-msg');

      forgotLink.addEventListener('click', e => {
        e.preventDefault();
        resetForm.reset();
        resetMsg.textContent = '';
        modal.style.display = 'flex';
      });
      closeBtn.addEventListener('click', () => modal.style.display = 'none');
      window.addEventListener('click', e => {
        if (e.target === modal) modal.style.display = 'none';
      });
      resetForm.addEventListener('submit', async e => {
        e.preventDefault();
        const email = document.getElementById('reset-email').value.trim();
        try {
          await firebase.auth().sendPasswordResetEmail(email);
          resetMsg.textContent = `✅ Enviado enlace a ${email}. Revisa tu bandeja.`;
        } catch (err) {
          if (err.code==='auth/user-not-found')      resetMsg.textContent = '❌ Cuenta no encontrada.';
          else if (err.code==='auth/invalid-email')  resetMsg.textContent = '❌ Correo inválido.';
          else                                       resetMsg.textContent = '❌ Error al enviar el correo.';
        }
      });
    });
  </script>
</body>
</html>
